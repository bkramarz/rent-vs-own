<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rent vs Own (Index Fund Equity Comparison)</title>
  <style>
    :root {
      color-scheme: light;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      margin: 18px;
      background: #fff;
    }

    h1 {
      margin: 0 0 12px;
      font-size: 22px;
    }

    /* Layout */
    .grid {
      display: grid;
      grid-template-columns: 380px 1fr;
      gap: 16px;
      align-items: start;
      max-width: 1200px;
    }

    .card {
      border: 1px solid #ddd;
      border-radius: 12px;
      padding: 14px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, .04);
      background: #fff;
      min-width: 0;
      /* helps prevent overflow on small screens */
    }

    /* Form rows */
    .row {
      display: grid;
      grid-template-columns: 1fr 160px;
      gap: 10px;
      align-items: center;
      margin: 10px 0;
    }

    label {
      font-size: 13px;
      color: #222;
    }

    input[type="text"],
    input[type="number"],
    select {
      width: 100%;
      padding: 10px 10px;
      border: 1px solid #ccc;
      border-radius: 10px;
      background: #fff;
      font-size: 14px;
    }

    input[type="range"] {
      width: 100%;
    }

    .muted {
      color: #555;
      font-size: 12px;
      line-height: 1.35;
    }

    /* KPI + Chart */
    .kpis {
      display: grid;
      grid-template-columns: repeat(3, minmax(180px, 1fr));
      gap: 10px;
    }

    .kpi {
      border: 1px solid #eee;
      border-radius: 12px;
      padding: 10px;
      background: #fff;
    }

    .kpi .t {
      font-size: 12px;
      color: #666;
    }

    .kpi .v {
      font-size: 18px;
      font-weight: 700;
      margin-top: 4px;
    }

    .kpi .s {
      font-size: 12px;
      color: #666;
      margin-top: 4px;
      line-height: 1.25;
    }

    /* Chart responsiveness */
    .chartWrap {
      margin-top: 14px;
    }

    canvas {
      width: 100% !important;
      height: 420px !important;
    }

    .pill {
      display: inline-block;
      padding: 2px 8px;
      border: 1px solid #ddd;
      border-radius: 999px;
      font-size: 12px;
      margin-left: 6px;
      white-space: nowrap;
    }

    .btnRow {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 14px;
    }

    .btn {
      width: 100%;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid #ccc;
      background: #f7f7f7;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
    }

    .btn.primary {
      background: #111;
      color: #fff;
      border-color: #111;
    }

    .btn:active {
      transform: translateY(1px);
    }

    .mini {
      font-size: 12px;
      color: #666;
      margin-top: 6px;
      line-height: 1.3;
    }

    hr {
      border: none;
      border-top: 1px solid #eee;
      margin: 14px 0;
    }

    /* ---------- Responsive breakpoints ---------- */

    /* Stack columns on tablets/phones */
    @media (max-width: 980px) {
      body {
        margin: 14px;
      }

      .grid {
        grid-template-columns: 1fr;
      }

      canvas {
        height: 360px !important;
      }
    }

    /* KPI cards: 2 columns */
    @media (max-width: 760px) {
      .kpis {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }

      canvas {
        height: 320px !important;
      }
    }

    /* Make form rows label-on-top for small phones */
    @media (max-width: 520px) {
      h1 {
        font-size: 20px;
      }

      .row {
        grid-template-columns: 1fr;
        gap: 6px;
        align-items: stretch;
      }

      .btnRow {
        grid-template-columns: 1fr;
      }

      .kpis {
        grid-template-columns: 1fr;
      }

      canvas {
        height: 280px !important;
      }
    }
  </style>
</head>

<body>
  <h1>Rent vs Own — compare home equity to index-fund investing</h1>

  <div class="grid">
    <div class="card">
      <div class="row">
        <label>House price ($)</label>
        <input id="housePrice" type="text" inputmode="numeric" value="1,000,000" aria-label="House price">
      </div>

      <div class="row">
        <label>
          Down payment
          <span class="pill"><span id="downPctLabel">20</span>%</span>
        </label>
        <input id="downPct" type="range" min="0" max="100" step="1" value="20">
      </div>

      <div class="row">
        <label>Rental income ($ / mo)</label>
        <input id="rentalIncome" type="text" inputmode="numeric" value="0" aria-label="Rental income monthly">
      </div>

      <div class="kpi" style="margin-top:10px;">
        <div class="t">Estimated monthly owning cost (today)</div>
        <div class="v" id="ownMonthlyCost">$—</div>
        <div class="s" id="ownMonthlyCostDetail">—</div>
      </div>

      <div class="row" style="margin-top:12px;">
        <label>Rent (monthly $)</label>
        <input id="rentMonthly" type="text" inputmode="numeric" value="3,000" aria-label="Rent monthly">
      </div>

      <hr>

      <div class="row">
        <label>Mortgage rate (APR %)</label>
        <input id="mortRate" type="number" min="0" step="0.05" value="6.50">
      </div>

      <div class="row">
        <label>Mortgage term (years)</label>
        <input id="mortYears" type="number" min="1" step="1" value="30">
      </div>

      <div class="row">
        <label>Property tax (% / yr)</label>
        <input id="propTax" type="number" min="0" step="0.10" value="1.20">
      </div>

      <div class="row">
        <label>Home insurance ($ / mo)</label>
        <input id="homeIns" type="number" min="0" step="25" value="200">
      </div>

      <div class="row">
        <label>Maintenance (% / yr)</label>
        <input id="maint" type="number" min="0" step="0.10" value="1.00">
      </div>

      <div class="row">
        <label>HOA ($ / mo)</label>
        <input id="hoa" type="number" min="0" step="25" value="0">
      </div>

      <div class="row">
        <label>Closing costs (% of purchase)</label>
        <input id="closing" type="number" min="0" step="0.10" value="2.00">
      </div>

      <hr>

      <div class="row">
        <label>Preset assumptions</label>
        <select id="preset">
          <option value="custom">Custom</option>
          <option value="conservative">Conservative</option>
          <option value="moderate" selected>Moderate</option>
          <option value="aggressive">Aggressive</option>
        </select>
      </div>
      <div class="mini" id="presetHint">Moderate sets: index 7.0%, home 3.0%, rent infl. 3.0%.</div>

      <div class="row">
        <label>Index fund return (% / yr)</label>
        <input id="indexReturn" type="number" min="-50" step="0.10" value="7.00">
      </div>

      <div class="row">
        <label>Home appreciation (% / yr)</label>
        <input id="homeApp" type="number" min="-50" step="0.10" value="3.00">
      </div>

      <div class="row">
        <label>Rent inflation (% / yr)</label>
        <input id="rentInfl" type="number" min="-50" step="0.10" value="3.00">
      </div>

      <div class="row">
        <label>
          Time horizon
          <span class="pill"><span id="horizonLabel">30</span> yrs</span>
        </label>
        <input id="horizonYears" type="range" min="1" max="40" step="1" value="30">
      </div>

      <div class="muted">
        Assumption: whoever has the <b>lower monthly cost</b> invests the difference in the index fund each month.
        The renter also invests the down payment + closing costs they didn’t spend.
        Rental income is assumed to inflate with the same rate as rent inflation.
      </div>

      <div class="btnRow">
        <button class="btn" id="resetBtn" type="button">Reset defaults</button>
        <button class="btn primary" id="moderateBtn" type="button">Set to Moderate</button>
      </div>
    </div>

    <div class="card">
      <div class="kpis">
        <div class="kpi">
          <div class="t">Owner net worth at horizon</div>
          <div class="v" id="ownerNW">$—</div>
          <div class="s" id="ownerDetail">—</div>
        </div>
        <div class="kpi">
          <div class="t">Renter net worth at horizon</div>
          <div class="v" id="renterNW">$—</div>
          <div class="s" id="renterDetail">—</div>
        </div>
        <div class="kpi">
          <div class="t">Difference (Owner − Renter)</div>
          <div class="v" id="diffNW">$—</div>
          <div class="s" id="diffDetail">—</div>
        </div>
      </div>

      <div class="chartWrap">
        <canvas id="chart"></canvas>
      </div>

      <div class="mini" style="margin-top:10px;">
        (Simplified: no PMI, no taxes, no selling costs, no refinance, no itemized deductions.)
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script>
    const $ = (id) => document.getElementById(id);

    function money(x) {
      if (!isFinite(x)) return "$—";
      return x.toLocaleString(undefined, { style: "currency", currency: "USD", maximumFractionDigits: 0 });
    }
    function clamp(x, a, b) { return Math.max(a, Math.min(b, x)); }

    function parseMoneyLike(inputStr) {
      if (typeof inputStr !== "string") return Number(inputStr) || 0;
      const cleaned = inputStr.replace(/[^0-9.-]/g, "");
      const n = Number(cleaned);
      return isFinite(n) ? n : 0;
    }
    function formatIntegerWithCommas(n) {
      const x = Math.round(Number(n) || 0);
      return x.toLocaleString(undefined, { maximumFractionDigits: 0 });
    }
    function formatMoneyInput(el) {
      const n = parseMoneyLike(el.value);
      el.value = formatIntegerWithCommas(n);
    }

    const DEFAULTS = {
      housePrice: 1000000,
      downPct: 20,
      rentMonthly: 3000,
      rentalIncome: 0,
      mortRate: 6.50,
      mortYears: 30,
      propTax: 1.20,
      homeIns: 200,
      maint: 1.00,
      hoa: 0,
      closing: 2.00,
      indexReturn: 7.00,
      homeApp: 3.00,
      rentInfl: 3.00,
      horizonYears: 30,
      preset: "moderate"
    };

    const PRESETS = {
      conservative: { indexReturn: 5.0, homeApp: 2.0, rentInfl: 2.5, hint: "Conservative sets: index 5.0%, home 2.0%, rent infl. 2.5%." },
      moderate: { indexReturn: 7.0, homeApp: 3.0, rentInfl: 3.0, hint: "Moderate sets: index 7.0%, home 3.0%, rent infl. 3.0%." },
      aggressive: { indexReturn: 9.0, homeApp: 4.0, rentInfl: 3.5, hint: "Aggressive sets: index 9.0%, home 4.0%, rent infl. 3.5%." }
    };

    function setPreset(name) {
      const p = PRESETS[name];
      if (!p) return;
      $("indexReturn").value = p.indexReturn.toFixed(2);
      $("homeApp").value = p.homeApp.toFixed(2);
      $("rentInfl").value = p.rentInfl.toFixed(2);
      $("preset").value = name;
      $("presetHint").textContent = p.hint;
      rebuild();
    }
    function markCustomPreset() {
      $("preset").value = "custom";
      $("presetHint").textContent = "Custom: you’ve overridden preset assumptions.";
    }

    function mortgagePayment(principal, annualRatePct, years) {
      const r = (annualRatePct / 100) / 12;
      const n = years * 12;
      if (principal <= 0) return 0;
      if (r === 0) return principal / n;
      return principal * (r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
    }

    function amortize(principal, annualRatePct, years) {
      const r = (annualRatePct / 100) / 12;
      const n = years * 12;
      const pmt = mortgagePayment(principal, annualRatePct, years);
      let bal = principal;
      const rows = [];
      for (let m = 1; m <= n; m++) {
        const interest = (r === 0) ? 0 : bal * r;
        const principalPaid = clamp(pmt - interest, 0, bal);
        bal = clamp(bal - principalPaid, 0, Infinity);
        rows.push({ month: m, payment: pmt, interest, principalPaid, balance: bal });
        if (bal <= 1e-6) break;
      }
      return { pmt, rows };
    }

    function initialOwnerMonthlyCost(params, mortPmt) {
      const homeValue = params.housePrice;
      const propTaxMonthly = (homeValue * (params.propTaxPct / 100)) / 12;
      const maintMonthly = (homeValue * (params.maintPct / 100)) / 12;

      const total =
        mortPmt +
        propTaxMonthly +
        params.homeInsMonthly +
        maintMonthly +
        params.hoaMonthly -
        params.rentalIncomeMonthly;

      return { total, propTaxMonthly, maintMonthly };
    }

    function simulate(params) {
      const {
        housePrice, downPct, rentMonthly, rentalIncomeMonthly,
        mortRate, mortYears, propTaxPct, homeInsMonthly, maintPct, hoaMonthly, closingPct,
        indexReturnPct, homeAppPct, rentInflPct,
        horizonYears
      } = params;

      const months = horizonYears * 12;

      const down = housePrice * (downPct / 100);
      const closing = housePrice * (closingPct / 100);
      const loan = clamp(housePrice - down, 0, Infinity);

      const amort = amortize(loan, mortRate, mortYears);
      const mortPmt = amort.pmt;

      const idxMonthly = (indexReturnPct / 100) / 12;
      const homeMonthlyApp = (homeAppPct / 100) / 12;
      const rentMonthlyInfl = (rentInflPct / 100) / 12;

      let ownerInvest = 0;
      let renterInvest = down + closing;

      let homeValue = housePrice;
      let mortgageBalance = loan;

      const series = { labels: [], ownerNW: [], renterNW: [], ownerEquity: [] };

      for (let m = 1; m <= months; m++) {
        homeValue *= (1 + homeMonthlyApp);

        const row = amort.rows[m - 1];
        mortgageBalance = row ? row.balance : 0;

        const propTaxMonthly = (homeValue * (propTaxPct / 100)) / 12;
        const maintMonthly = (homeValue * (maintPct / 100)) / 12;

        const rentThisMonth = rentMonthly * Math.pow(1 + rentMonthlyInfl, m - 1);
        const rentalIncomeThisMonth = rentalIncomeMonthly * Math.pow(1 + rentMonthlyInfl, m - 1);

        const ownerMonthlyCost =
          mortPmt + propTaxMonthly + homeInsMonthly + maintMonthly + hoaMonthly - rentalIncomeThisMonth;

        const diff = ownerMonthlyCost - rentThisMonth;
        if (diff > 0) renterInvest += diff;
        else ownerInvest += (-diff);

        ownerInvest *= (1 + idxMonthly);
        renterInvest *= (1 + idxMonthly);

        const ownerEquity = clamp(homeValue - mortgageBalance, 0, Infinity);
        const ownerNetWorth = ownerEquity + ownerInvest;
        const renterNetWorth = renterInvest;

        if (m % 3 === 0 || m === 1 || m === months) {
          series.labels.push((m / 12).toFixed(1) + "y");
          series.ownerNW.push(ownerNetWorth);
          series.renterNW.push(renterNetWorth);
          series.ownerEquity.push(ownerEquity);
        }
      }

      const ownerEquityEnd = series.ownerEquity[series.ownerEquity.length - 1];
      const ownerNWEnd = series.ownerNW[series.ownerNW.length - 1];
      const ownerInvestEnd = ownerNWEnd - ownerEquityEnd;
      const renterNWEnd = series.renterNW[series.renterNW.length - 1];

      return { down, closing, loan, mortPmt, ownerNWEnd, renterNWEnd, ownerEquityEnd, ownerInvestEnd, series };
    }

    let chart;

    function rebuild() {
      const downPct = Number($("downPct").value);
      $("downPctLabel").textContent = downPct;

      const horizonYears = Number($("horizonYears").value);
      $("horizonLabel").textContent = horizonYears;

      const params = {
        housePrice: parseMoneyLike($("housePrice").value),
        downPct,
        rentMonthly: parseMoneyLike($("rentMonthly").value),
        rentalIncomeMonthly: parseMoneyLike($("rentalIncome").value),

        mortRate: Number($("mortRate").value),
        mortYears: Number($("mortYears").value),
        propTaxPct: Number($("propTax").value),
        homeInsMonthly: Number($("homeIns").value),
        maintPct: Number($("maint").value),
        hoaMonthly: Number($("hoa").value),
        closingPct: Number($("closing").value),

        indexReturnPct: Number($("indexReturn").value),
        homeAppPct: Number($("homeApp").value),
        rentInflPct: Number($("rentInfl").value),
        horizonYears
      };

      const out = simulate(params);

      const own0 = initialOwnerMonthlyCost(params, out.mortPmt);
      $("ownMonthlyCost").textContent = money(own0.total) + "/mo";
      $("ownMonthlyCostDetail").textContent =
        `P&I ${money(out.mortPmt)} + tax ${money(own0.propTaxMonthly)} + ins ${money(params.homeInsMonthly)} + maint ${money(own0.maintMonthly)} + HOA ${money(params.hoaMonthly)} − rent ${money(params.rentalIncomeMonthly)}`;

      $("ownerNW").textContent = money(out.ownerNWEnd);
      $("ownerDetail").textContent = `Equity: ${money(out.ownerEquityEnd)} • Index fund: ${money(out.ownerInvestEnd)}`;

      $("renterNW").textContent = money(out.renterNWEnd);
      $("renterDetail").textContent = `Starts invested: ${money(out.down + out.closing)} • Grows with monthly savings`;

      const diff = out.ownerNWEnd - out.renterNWEnd;
      $("diffNW").textContent = money(diff);
      $("diffDetail").textContent =
        `Down: ${money(out.down)} • Closing: ${money(out.closing)} • Loan: ${money(out.loan)} • P&I: ${money(out.mortPmt)}/mo`;

      const data = {
        labels: out.series.labels,
        datasets: [
          { label: "Owner net worth (equity + investments)", data: out.series.ownerNW, borderWidth: 2, tension: 0.2 },
          { label: "Renter net worth (index fund)", data: out.series.renterNW, borderWidth: 2, tension: 0.2 },
          { label: "Owner home equity (subset)", data: out.series.ownerEquity, borderDash: [6, 5], borderWidth: 1.5, tension: 0.2 }
        ]
      };

      const options = {
        responsive: true,
        maintainAspectRatio: false,
        interaction: { mode: "index", intersect: false },
        plugins: {
          tooltip: { callbacks: { label: (ctx) => `${ctx.dataset.label}: ${money(ctx.raw)}` } },
          legend: { position: "top" }
        },
        scales: {
          y: {
            ticks: {
              callback: (v) => {
                const n = Number(v);
                if (Math.abs(n) >= 1e6) return (n / 1e6).toFixed(1) + "M";
                if (Math.abs(n) >= 1e3) return (n / 1e3).toFixed(0) + "k";
                return n.toFixed(0);
              }
            }
          }
        }
      };

      if (!chart) chart = new Chart($("chart"), { type: "line", data, options });
      else { chart.data = data; chart.options = options; chart.update(); }
    }

    function resetDefaults() {
      $("housePrice").value = formatIntegerWithCommas(DEFAULTS.housePrice);
      $("downPct").value = DEFAULTS.downPct;
      $("rentMonthly").value = formatIntegerWithCommas(DEFAULTS.rentMonthly);
      $("rentalIncome").value = formatIntegerWithCommas(DEFAULTS.rentalIncome);

      $("mortRate").value = DEFAULTS.mortRate.toFixed(2);
      $("mortYears").value = DEFAULTS.mortYears;
      $("propTax").value = DEFAULTS.propTax.toFixed(2);
      $("homeIns").value = DEFAULTS.homeIns;
      $("maint").value = DEFAULTS.maint.toFixed(2);
      $("hoa").value = DEFAULTS.hoa;
      $("closing").value = DEFAULTS.closing.toFixed(2);

      $("indexReturn").value = DEFAULTS.indexReturn.toFixed(2);
      $("homeApp").value = DEFAULTS.homeApp.toFixed(2);
      $("rentInfl").value = DEFAULTS.rentInfl.toFixed(2);

      $("horizonYears").value = DEFAULTS.horizonYears;
      $("preset").value = DEFAULTS.preset;
      $("presetHint").textContent = PRESETS.moderate.hint;

      rebuild();
    }

    ["housePrice", "rentMonthly", "rentalIncome"].forEach(id => {
      $(id).addEventListener("blur", () => { formatMoneyInput($(id)); rebuild(); });
      $(id).addEventListener("input", rebuild);
    });

    ["downPct", "mortRate", "mortYears", "propTax", "homeIns", "maint", "hoa", "closing", "horizonYears"]
      .forEach(id => $(id).addEventListener("input", rebuild));

    ["indexReturn", "homeApp", "rentInfl"].forEach(id => {
      $(id).addEventListener("input", () => { markCustomPreset(); rebuild(); });
    });

    $("preset").addEventListener("change", (e) => {
      const val = e.target.value;
      if (val === "custom") { markCustomPreset(); return; }
      setPreset(val);
    });

    $("resetBtn").addEventListener("click", resetDefaults);
    $("moderateBtn").addEventListener("click", () => setPreset("moderate"));

    resetDefaults();
  </script>
</body>

</html>